digraph controller_fsm {
    // rankdir = "LR";

    node [shape=point] RESET;

    node [shape=box, margin=0];
    IDLE;

    RD_START;
    RD_EVICT_WORD0;
    RD_EVICT_WORD1;
    RD_EVICT_WORD2;
    RD_EVICT_WORD3;
    RD_EVICT_WAIT0;
    RD_EVICT_WAIT1;
    RD_EVICT_WAIT2;
    RD_EVICT_DONE;
    RD_LOAD_WORD0;
    RD_LOAD_WORD1;
    RD_LOAD_WORD2;
    RD_LOAD_WORD3;
    RD_LOAD_WAIT0;
    RD_LOAD_DONE;
    RD_FROM_CACHE;

    WR_START;
    WR_EVICT_WORD0;
    WR_EVICT_WORD1;
    WR_EVICT_WORD2;
    WR_EVICT_WORD3;
    WR_EVICT_WAIT0;
    WR_EVICT_WAIT1;
    WR_EVICT_WAIT2;
    WR_EVICT_DONE;
    WR_LOAD_WORD0;
    WR_LOAD_WORD1;
    WR_LOAD_WORD2;
    WR_LOAD_WORD3;
    WR_LOAD_WAIT0;
    WR_LOAD_DONE;
    WR_TO_CACHE;

    RESET -> IDLE;
    IDLE  -> RD_START;
    IDLE  -> WR_START;
    IDLE  -> IDLE;

    RD_START -> RD_EVICT_WORD0;
    RD_START -> RD_LOAD_WORD0;

    RD_EVICT_WORD0 -> RD_EVICT_WORD1;
    RD_EVICT_WORD1 -> RD_EVICT_WORD2;
    RD_EVICT_WORD2 -> RD_EVICT_WORD3;
    RD_EVICT_WORD3 -> RD_EVICT_WAIT0;

    RD_EVICT_WAIT0 -> RD_EVICT_WAIT1;
    RD_EVICT_WAIT1 -> RD_EVICT_WAIT2;
    RD_EVICT_WAIT2 -> RD_EVICT_DONE;
    RD_EVICT_DONE  -> RD_LOAD_WORD0;

    RD_LOAD_WORD0 -> RD_LOAD_WORD1;
    RD_LOAD_WORD1 -> RD_LOAD_WORD2;
    RD_LOAD_WORD2 -> RD_LOAD_WORD3;
    RD_LOAD_WORD3 -> RD_LOAD_WAIT0;

    RD_LOAD_WAIT0 -> RD_LOAD_DONE;
    RD_LOAD_DONE  -> RD_FROM_CACHE;
    RD_FROM_CACHE -> IDLE;

    WR_START -> WR_EVICT_WORD0;
    WR_START -> WR_LOAD_WORD0;

    WR_EVICT_WORD0 -> WR_EVICT_WORD1;
    WR_EVICT_WORD1 -> WR_EVICT_WORD2;
    WR_EVICT_WORD2 -> WR_EVICT_WORD3;
    WR_EVICT_WORD3 -> WR_EVICT_WAIT0;

    WR_EVICT_WAIT0 -> WR_EVICT_WAIT1;
    WR_EVICT_WAIT1 -> WR_EVICT_WAIT2;
    WR_EVICT_WAIT2 -> WR_EVICT_DONE;
    WR_EVICT_DONE  -> WR_LOAD_WORD0;

    WR_LOAD_WORD0 -> WR_LOAD_WORD1;
    WR_LOAD_WORD1 -> WR_LOAD_WORD2;
    WR_LOAD_WORD2 -> WR_LOAD_WORD3;
    WR_LOAD_WORD3 -> WR_LOAD_WAIT0;

    WR_LOAD_WAIT0 -> WR_LOAD_DONE;
    WR_LOAD_DONE  -> WR_TO_CACHE;
    WR_TO_CACHE -> IDLE;
}
